<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Keep Lord: Warriors</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>
    <script type="module">
      import { drawPentagon } from "./dist/rendering.js";
      import { CanvasControls } from "./dist/controls.js";
      import { Connection } from "./dist/connection.js";
      import { Performance } from "./dist/performance.js";

      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");
      const controls = new CanvasControls(canvas, draw);
      const connection = new Connection();
      const performance = new Performance();

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        draw();
      }

      function draw() {
        const { scale, offsetX, offsetY } = controls.getTransform();

        ctx.save();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.scale(scale, scale);
        ctx.translate(offsetX, offsetY);

        drawGrid();
        drawShapes();

        ctx.restore();
      }

      function drawGrid() {
        const { offsetX, offsetY } = controls.getTransform();
        ctx.fillStyle = "#cbd5e1";
        const gridSize = 20;
        const roundedX = Math.trunc(offsetX / gridSize) * gridSize;
        const roundedY = Math.trunc(offsetY / gridSize) * gridSize;
        for (let x = -roundedX; x < canvas.width - roundedX; x += gridSize) {
          for (let y = -roundedY; y < canvas.height - roundedY; y += gridSize) {
            ctx.beginPath();
            ctx.arc(x, y, 1, 0, Math.PI * 2);
            ctx.fill();
          }
        }
      }

      function update(currentTime) {
        requestAnimationFrame((time) => update(time));
        performance.start();

        draw();

        performance.stop();
        performance.draw(ctx, canvas);
      }

      function drawShapes() {
        drawPentagon(ctx, 300, 300, 50, "rgba(255, 0, 255, 0.5)");
      }

      // Initial setup
      resizeCanvas();
      update();

      // Event listeners
      window.addEventListener("resize", resizeCanvas);
    </script>
  </body>
</html>
